name: Push Main to Branches

on:
  push:
    branches:
      - 'Main-(Production)'  # Trigger the workflow when changes are pushed to 'Main-(Production)'

jobs:
  push_to_branches:
    runs-on: ubuntu-latest

    steps:
      - name: Use Node.js 16.x
        uses: actions/setup-node@v2
        with:
          node-version: '16.x'

      - name: Check out code
        uses: actions/checkout@v2

      - name: Fetch latest changes
        run: git fetch --prune

      - name: Push changes to branches
        run: |
          # Initialize an array to store conflict information
          conflicts=()
          handle_error() {
            echo "Error: $1"
            conflicts+=("$1")
          }

          git checkout Staging || handle_error "Failed to switch to 'Staging' branch."
          git pull --no-rebase origin 'Main-(Production)' || handle_error "Failed to pull changes from 'Main-(Production)'."
          git push origin Staging || handle_error "Failed to push changes to 'Staging' branch."

          # Check for conflicts
          if [ ${#conflicts[@]} -gt 0 ]; then
              echo "Conflicts encountered during the process:"
              for conflict in "${conflicts[@]}"; do
                  echo "- $conflict"
              done
              exit 1  # Exit with an error code
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        shell: bash
